@model Project

@{
    bool isUserInProject = Model.UsersInProject.Any(uip => uip.User.UserName == User.Identity.Name);
}

<div asp-validation-summary="All" class="text-danger"></div>

<table class="table">
    <thead>
        <td>Titel</td>
        <td>Beskrivning</td>
        <td>Startdatum</td>
        <td>Slutdatum</td>
        <td>Skapad av</td>
        <td>Deltagare</td>
    </thead>
    <tbody>

        <tr>
            <td>@Model.Titel</td>
            <td>@Model.Description</td>
            <td>@Model.StartDate</td>
            <td>@Model.EndDate</td>
            <td>@Model.user.Firstname @Model.user.Lastname</td>
            <td> 
                @foreach (var uip in @Model.UsersInProject){
                    @if (!User.Identity.IsAuthenticated)
                    {
                        @if (uip.User.PublicSetting == true && uip.User.IsActive == true)
                        {
                            @uip.User.Firstname @(" ") @uip.User.Lastname @(", ")
                        }
                        
                    }
                    else
                    {
                        if (uip.User.IsActive == false)
                        {

                        }
                        else
                        {
                            @uip.User.Firstname @(" ") @uip.User.Lastname @(", ")
                        }
                        
                    }
                }

            </td>


        </tr>

    </tbody>
</table>

@if (User.Identity.Name == Model.user.UserName)
{
    <div asp-validation-summary="All" class="text-danger"></div>

    <h2>Redigera projektet: </h2>
    <form class="border border-dark" style="padding: 20px;" asp-action="EditProject" method="post">
        <label>Titel: </label>
        <input id="projectTitle" name="Titel" asp-for="Titel" />
        <br />
        <label>Beskrivning: </label>
        <input id="projectDescription" name="Description" asp-for="Description" />
        <br />
        <label>Startdatum: </label>
        <input id="startDate" name="StartDate" type="date" asp-for="StartDate" />
        <br />
        <label>Slutdatum: </label>
        <input id="endDate" name="EndDate" type="date" asp-for="EndDate" />
        <br />
        <input name="CreatorID" type="hidden" value="@Model.CreatorID" asp-for="CreatorID" />
        <br />
        <br />
        <input name="ProjectID" type="hidden" value="@Model.ProjectID" asp-for="ProjectID" />
        <br />
        <button class="btn btn-outline-success" id="saveProject" type="submit" disabled>Spara ändringar</button>
    </form>

    //Script som gör att spara-knappen blir ej klickbar om någonting lämnas tomt
    <script>
        const titleInput = document.getElementById("projectTitle");
        const descriptionInput = document.getElementById("projectDescription");
        const startDateInput = document.getElementById("startDate");
        const endDateInput = document.getElementById("endDate");
        const saveButton = document.getElementById("saveProject");

        
        function isDateValid(dateString) {
            // Kontrollera om datumet matchar det förväntade formatet (yyyy-mm-dd)
            const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
            return dateRegex.test(dateString);
        }

        function validateInputs() {
            // Kontrollera om titel och beskrivning är ifyllda
            const isTitleValid = titleInput.value.trim() !== "";
            const isDescriptionValid = descriptionInput.value.trim() !== "";
            const isStartDateValid = isDateValid(startDateInput.value);
            const isEndDateValid = isDateValid(endDateInput.value);

            // Aktivera eller inaktivera knappen baserat på valideringen
            if (isTitleValid && isDescriptionValid && isStartDateValid && isEndDateValid) {
                saveButton.disabled = false;
            } else {
                saveButton.disabled = true;
            }
        }

        // Lägg till event listeners på alla inputs
        titleInput.addEventListener("input", validateInputs);
        descriptionInput.addEventListener("input", validateInputs);
        startDateInput.addEventListener("input", validateInputs);
        endDateInput.addEventListener("input", validateInputs);

        // Kör en initial validering när sidan laddas
        validateInputs();
    </script>

   
    
}
else {
    

@if (isUserInProject)
{
    <form asp-controller="Project" asp-action="LeaveProject" method="post">
        <input type="hidden" name="projectID" value="@Model.ProjectID" />
        <button class="btn btn-outline-danger" type="submit">Gå ur</button>
    </form>
}
else
{
    <form asp-controller="Project" asp-action="JoinProject" method="post">
        <input type="hidden" name="projectID" value="@Model.ProjectID" />
        <button class="btn btn-outline-primary" type="submit">Gå med</button>
    </form>
}

   
}


